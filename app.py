"""
–ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Streamlit –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤
"""
import streamlit as st
import pandas as pd
import numpy as np
from datetime import datetime, timedelta
import plotly.express as px
import io
import json

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
st.set_page_config(
    page_title="–û–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä –º–∞—Ä—à—Ä—É—Ç–æ–≤",
    page_icon="üó∫Ô∏è",
    layout="wide"
)

def main():
    st.title("üó∫Ô∏è –û–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä –º–∞—Ä—à—Ä—É—Ç–æ–≤ –∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞")
    
    # –°–∞–π–¥–±–∞—Ä
    with st.sidebar:
        st.header("‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏")
        
        # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
        max_hours = st.slider(
            "–ú–∞–∫—Å. —á–∞—Å–æ–≤ –≤ –¥–µ–Ω—å",
            min_value=4.0,
            max_value=12.0,
            value=8.0,
            step=0.5
        )
        
        max_days = st.slider(
            "–ú–∞–∫—Å. –¥–Ω–µ–π –≤ –Ω–µ–¥–µ–ª—é",
            min_value=1,
            max_value=7,
            value=5
        )
        
        start_date = st.date_input(
            "–ù–∞—á–∞–ª–æ –∫–≤–∞—Ä—Ç–∞–ª–∞",
            value=datetime.now()
        )
        
        # –ö–Ω–æ–ø–∫–∞ –¥–ª—è –¥–µ–º–æ
        run_demo = st.button("üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–º–æ", type="primary")
    
    # –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å
    if run_demo:
        with st.spinner("–°–æ–∑–¥–∞–µ–º –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ..."):
            # –°–æ–∑–¥–∞–µ–º –ø—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö
            demo_data = create_demo_data()
            
            # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            st.subheader("üìä –ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö")
            st.dataframe(demo_data)
            
            # –ó–∞–ø—É—Å–∫–∞–µ–º –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é
            st.subheader("‚ö° –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏")
            
            col1, col2, col3 = st.columns(3)
            with col1:
                st.metric("–¢—Ä–µ–±—É–µ—Ç—Å—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤", 3)
            with col2:
                st.metric("–í—Å–µ–≥–æ –º–∞—Ä—à—Ä—É—Ç–æ–≤", 15)
            with col3:
                st.metric("–í—Å–µ–≥–æ –ø–æ—Å–µ—â–µ–Ω–∏–π", 45)
            
            # –ü—Ä–∏–º–µ—Ä —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
            st.subheader("üóìÔ∏è –ü—Ä–∏–º–µ—Ä —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è")
            
            # –°–æ–∑–¥–∞–µ–º –ø—Ä–∏–º–µ—Ä —Ç–∞–±–ª–∏—Ü—ã
            schedule_data = []
            for i in range(5):
                schedule_data.append({
                    '–î–∞—Ç–∞': f'2024-01-{10+i}',
                    '–î–µ–Ω—å': ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç'][i],
                    '–°–æ—Ç—Ä—É–¥–Ω–∏–∫': f'–°–æ—Ç—Ä—É–¥–Ω–∏–∫_{i%3+1}',
                    '–ú–∞—Ä—à—Ä—É—Ç': f'R{i+1}',
                    '–¢–æ—á–µ–∫': 3,
                    '–í—Ä–µ–º—è (—á)': round(6 + i*0.5, 1)
                })
            
            df_schedule = pd.DataFrame(schedule_data)
            st.dataframe(df_schedule)
            
            # –ì—Ä–∞—Ñ–∏–∫
            st.subheader("üìà –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤")
            
            emp_data = pd.DataFrame({
                '–°–æ—Ç—Ä—É–¥–Ω–∏–∫': ['–°–æ—Ç—Ä—É–¥–Ω–∏–∫_1', '–°–æ—Ç—Ä—É–¥–Ω–∏–∫_2', '–°–æ—Ç—Ä—É–¥–Ω–∏–∫_3'],
                '–ú–∞—Ä—à—Ä—É—Ç–æ–≤': [5, 6, 4],
                '–ß–∞—Å–æ–≤': [32.5, 38.0, 26.5]
            })
            
            fig = px.bar(emp_data, x='–°–æ—Ç—Ä—É–¥–Ω–∏–∫', y='–ß–∞—Å–æ–≤', 
                        title='–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏')
            st.plotly_chart(fig)
            
            # –≠–∫—Å–ø–æ—Ä—Ç
            st.subheader("üíæ –≠–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤")
            
            # Excel —Ñ–∞–π–ª
            output = io.BytesIO()
            with pd.ExcelWriter(output, engine='openpyxl') as writer:
                df_schedule.to_excel(writer, sheet_name='–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ', index=False)
                emp_data.to_excel(writer, sheet_name='–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏', index=False)
            
            output.seek(0)
            
            st.download_button(
                label="üì• –°–∫–∞—á–∞—Ç—å Excel",
                data=output,
                file_name="–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è_–º–∞—Ä—à—Ä—É—Ç–æ–≤.xlsx",
                mime="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
            )

def create_demo_data():
    """–°–æ–∑–¥–∞–Ω–∏–µ –¥–µ–º–æ-–¥–∞–Ω–Ω—ã—Ö"""
    data = {
        '–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ—á–∫–∏': ['–ú–∞–≥–∞–∑–∏–Ω –ê', '–ú–∞–≥–∞–∑–∏–Ω –ë', '–ú–∞–≥–∞–∑–∏–Ω –í', 
                          '–ú–∞–≥–∞–∑–∏–Ω –ì', '–ú–∞–≥–∞–∑–∏–Ω –î', '–ú–∞–≥–∞–∑–∏–Ω –ï'],
        '–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ—Å–µ—â–µ–Ω–∏—è —Ç–æ—á–∫–∏, –º–∏–Ω—É—Ç': [30, 45, 60, 30, 90, 45],
        '–°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –Ω–∞–¥–æ –ø–æ—Å–µ—Ç–∏—Ç—å —Ç–æ—á–∫—É': [4, 3, 2, 5, 1, 3],
        'ID —Ç–æ—á–∫–∏': [1, 2, 3, 4, 5, 6],
        '–ê–¥—Ä–µ—Å': [
            '—É–ª. –õ–µ–Ω–∏–Ω–∞, 1',
            '—É–ª. –ü—É—à–∫–∏–Ω–∞, 10',
            '–ø—Ä. –ú–∏—Ä–∞, 25',
            '—É–ª. –°–∞–¥–æ–≤–∞—è, 5',
            '—É–ª. –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è, 15',
            '–ø—Ä. –°—Ç—Ä–æ–∏—Ç–µ–ª–µ–π, 8'
        ],
        'Latitude': [55.75, 55.76, 55.74, 55.77, 55.73, 55.75],
        'Longitude': [37.61, 37.62, 37.60, 37.63, 37.59, 37.61]
    }
    
    return pd.DataFrame(data)

if __name__ == "__main__":
    main()